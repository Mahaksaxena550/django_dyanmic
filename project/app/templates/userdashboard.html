{% extends "base.html" %}

{% block nav %}{% endblock nav %}

{% block title %}
<title>User Dashboard</title>
{% endblock %}

{% block content %}
<style>
/* ===== BODY ===== */
body {
    background:#f4f6f9;
    overflow-x:hidden;
    font-family: 'Segoe UI', sans-serif;
    margin:0;
}

/* ===== SIDEBAR ===== */
.sidebar {
    position:fixed;
    top:0;
    left:0;
    height:100vh;
    background:linear-gradient(180deg,#1e3c72,#2a5298);
    color:#fff;
    transition: width 0.3s ease;
    z-index: 1000;
    overflow:hidden;
    width:70px; /* mini by default */
    padding:20px 5px;
}
.user-box {
    text-align:center;
    margin-bottom:25px;
}
.user-box img {
    width:50px;
    height:50px;
    border-radius:50%;
    object-fit:cover;
    border:none;
    box-shadow: 0 6px 15px rgba(13,110,253,0.2), 0 3px 8px rgba(0,0,0,0.08);
    transition: width 0.3s, height 0.3s, transform 0.3s, box-shadow 0.3s;
}
.user-box h6, .user-box small {
    opacity:0;
    transition: opacity 0.3s;
    white-space: nowrap;
    overflow: hidden;
}
.sidebar a {
    display:flex;
    align-items:center;
    color:#fff;
    text-decoration:none;
    padding:10px 12px;
    border-radius:8px;
    margin-bottom:8px;
    justify-content:center; /* center icons */
    transition:0.3s;
}
.sidebar a i {
    font-size:1.3rem;
    transition: transform 0.3s;
}
.sidebar a span {
    display:none;
    margin-left:10px;
    white-space: nowrap;
}

/* hover effects */
.sidebar a:hover {
    background: rgba(255,255,255,0.2);
    transform: translateX(5px);
    color: #ffd700;
}
.sidebar a:hover i {
    transform: rotate(20deg) scale(1.2);
}
.sidebar a.active {
    background: rgba(255,255,255,0.3);
    font-weight:600;
}

/* MINI -> FULL ON HOVER */
.sidebar:hover {
    width:260px;
}
.sidebar:hover .user-box img {
    width:90px;
    height:90px;
    transform: scale(1.08);
    box-shadow:0 12px 30px rgba(13,110,253,0.5),0 6px 15px rgba(0,0,0,0.15);
}
.sidebar:hover .user-box h6,
.sidebar:hover .user-box small,
.sidebar:hover a span {
    opacity:1;
    display:inline;
}

/* ===== OVERLAY ===== */
.overlay {
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(4px);
    z-index:900;
    display:none;
}

/* ===== TOPBAR ===== */
.topbar {
    position:fixed;
    top:0;
    left:70px; /* mini width */
    right:0;
    height:60px;
    background:#fff;
    display:flex;
    align-items:center;
    justify-content:flex-end;
    padding:0 20px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    z-index:1001;
    transition: left 0.3s ease;
}
.sidebar:hover ~ .topbar {
    left:260px;
}

.topbar button#menu-btn {
    display:none;
    background:none;
    border:none;
    font-size:1.5rem;
    margin-right:auto;
    cursor:pointer;
    color:#0d6efd;
}

/* ===== MAIN CONTENT ===== */
.main-content {
    margin-left:70px; /* mini width */
    margin-top:80px;
    padding:25px;
    transition: margin-left 0.3s ease;
}
.sidebar:hover ~ .main-content {
    margin-left:260px;
}

/* ===== CARDS ===== */
.card {
    border-radius:18px;
    transition:0.3s;
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(10px);
    border:1px solid rgba(255,255,255,0.2);
    cursor: pointer;
    overflow:hidden;
    width:100%;
    max-width:100%;
    margin-bottom:18px;
}
.card:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 18px 38px rgba(0,0,0,0.2);
}
.card:hover h5, .card:hover p {
    color: #0d6efd;
    transition:0.3s;
}

/* ===== GRADIENT TEXT ===== */
.gradient-text {
    background: linear-gradient(45deg, #0d6efd, #6610f2, #0dcaf0);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradientMove 3s ease infinite;
}
@keyframes gradientMove {
    0% {background-position:0% 50%;}
    50% {background-position:100% 50%;}
    100% {background-position:0% 50%;}
}

/* ===== TABLES & FORMS ===== */
.table-responsive {overflow-x:auto;}
.table {border-radius:10px; overflow:hidden; background: rgba(255,255,255,0.05); transition: 0.3s;}
.table th, .table td {vertical-align:middle !important;}
.table-hover tbody tr:hover {background: linear-gradient(90deg, rgba(13,110,253,0.15), rgba(13,110,253,0.05)); color:#0d6efd;}
.table-striped tbody tr:nth-of-type(odd) {background-color: rgba(0,0,0,0.02);}
.table .btn {border-radius:8px; padding:4px 10px; font-size:0.85rem; transition:0.2s;}
.table .btn i {margin-right:4px;}
.table .btn:hover {transform: translateY(-2px);}

.form-control, .form-select, textarea {
    border-radius:10px; transition:0.3s; box-shadow:none; border:1px solid #ced4da;
}
.form-control:focus, .form-select:focus, textarea:focus {
    border-color:#0d6efd;
    box-shadow:0 0 0 0.2rem rgba(13,110,253,0.25);
}

/* ===== BUTTONS ===== */
.btn-primary, .btn-danger, .btn-warning {
    border-radius:50px; transition:0.2s, transform 0.2s;
}
.btn-primary:hover {background-color:#0b5ed7; transform: translateY(-3px) scale(1.05);}
.btn-danger:hover {background-color:#c82333; transform: translateY(-3px) scale(1.05);}
.btn-warning:hover {background-color:#e0a800; transform: translateY(-3px) scale(1.05);}

/* ===== QUERY STATUS BADGES ===== */
.status-open {background-color:#dc3545; color:#fff; padding:3px 8px; border-radius:12px; font-size:0.8rem;}
.status-closed {background-color:#198754; color:#fff; padding:3px 8px; border-radius:12px; font-size:0.8rem;}

/* ===== PROFILE CARD IMAGE ROUND & HOVER ===== */
.card .text-center img {border-radius:50%; width:110px; height:110px; object-fit:cover; transition:0.3s;}
.card .text-center img:hover {transform:scale(1.12); box-shadow:0 14px 35px rgba(13,110,253,0.5),0 6px 18px rgba(0,0,0,0.15);}

/* ===== RESPONSIVE ===== */
@media (max-width:991px){
    .sidebar {transform:translateX(-100%); width:260px; padding:20px;}
    .sidebar.show {transform:translateX(0);}
    .topbar {left:0; padding:0 15px;}
    .topbar button#menu-btn {display:block;}
    .main-content {margin-left:0; padding:15px;}
    body.sidebar-open .main-content {margin-left:260px;}
}
@media (max-width:576px){
    .sidebar {width:220px; padding:15px;}
    .user-box img {width:70px; height:70px;}
    .topbar a.btn {padding:0.25rem 0.5rem; font-size:0.75rem;}
    .d-flex.flex-sm-row {flex-direction: column !important; align-items: flex-start !important; gap:0.5rem;}
}
</style>

<!-- ===== OVERLAY ===== -->
<div class="overlay" id="overlay"></div>

<!-- ===== SIDEBAR ===== -->
<div class="sidebar" id="sidebar">
  <div class="user-box">
    <img src="{{ data.image.url }}" onerror="this.src='https://via.placeholder.com/90'">
    <h6>{{ data.name }}</h6>
    <small>{{ data.email }}</small>
  </div>
  <a href="{% url 'profile' %}"><i class="bi bi-person-circle"></i> <span>Profile</span></a>
  <a href="{% url 'query' %}"><i class="bi bi-question-circle"></i> <span>Raise Query</span></a>
  <a href="{% url 'query_status' %}"><i class="bi bi-bar-chart-line"></i> <span>Query Status</span></a>
  <a href="{% url 'all_query' %}"><i class="bi bi-card-list"></i> <span>All Queries</span></a>
</div>

<!-- ===== TOPBAR ===== -->
<div class="topbar">
  <button id="menu-btn">â˜°</button>
  <a href="{% url 'logout' %}" class="btn btn-danger btn-sm">ðŸšª Logout</a>
</div>

<!-- ===== MAIN CONTENT ===== -->
<div class="main-content">

  <h4 class="mb-4">Welcome, <span class="gradient-text">{{ data.name }}</span></h4>

  {% if profile %}
  <div class="card shadow p-4" style="max-width:450px; margin:auto;">
    <div class="text-center mb-3">
      <img src="{{ data.image.url }}" onerror="this.src='https://via.placeholder.com/120'">
    </div>
    <h5 class="text-center mb-3 gradient-text">My Profile</h5>
    <p><strong>Name:</strong> {{ data.name }}</p>
    <p><strong>Email:</strong> {{ data.email }}</p>
    <p><strong>Contact:</strong> {{ data.contact }}</p>
    <p><strong>Department:</strong> {{ data.department }}</p>
  </div>
  {% endif %}

  {% if query %}
  <div class="card shadow p-4">
    <h5 class="mb-3 gradient-text">Raise Query</h5>
    <form method="post" action="{% url 'query_data' %}">
      {% csrf_token %}
      <input class="form-control mb-3" name="name" value="{{ data.name }}" readonly>
      <input class="form-control mb-3" name="email" value="{{ data.email }}" readonly>
      <select name="subject" class="form-control mb-3"> Subject
        <option value="option">--Select Subject--</option>
        <option value="attandance">Attandance</option>
        <option value="salary">Salary</option>
        <option value="profile">Profile</option>
        <option value="leave">Leave</option>
      </select>
      
      <textarea name="query" class="form-control mb-3" rows="4" placeholder="Write your query here..."></textarea>
      <button class="btn btn-primary">Submit</button>
    </form>
  </div>
  {% endif %}

  {% if query_status %}
  <div class="card shadow p-4 table-responsive">
    <h5 class="mb-3 gradient-text">Query Status</h5>
    <table class="table table-hover table-striped">
      <thead class="table-dark">
        <tr>
          <th>S.no.</th>
          <th>Query</th>
          <th>Status</th>
          <th>Solution</th>
          
        </tr>
      </thead>
      <tbody>
        {% for q in query_status %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ q.message }}</td>
          <td>
            {{q.status}}
          </td>
          <td>{{ q.solution}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  {% if all_query %}
  <div class="card shadow p-4 table-responsive">
    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-3 gap-2">
      <h5 class="mb-0 gradient-text">All Queries</h5>
      <input type="text" id="searchInput" class="form-control w-50 w-sm-25" placeholder="Search query...">
    </div>
    <table class="table table-bordered table-hover table-striped" id="queryTable">
      <thead class="table-dark">
        <tr>
          <th>S.No</th>
          <th>Query</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for q in queries %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ q.query }}</td>
          <td>
            <a href="{% url 'edit_query' q.id %}" class="btn btn-sm btn-warning"><i class="bi bi-pencil-square"></i> Edit</a>
          </td>
          <td>
            <a href="{% url 'delete_query' q.id %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')"><i class="bi bi-trash"></i> Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-center">No Queries Found</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>

<script>
// Sidebar toggle for mobile
const menuBtn = document.getElementById('menu-btn');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const body = document.body;

menuBtn.addEventListener('click', () => {
    sidebar.classList.toggle('show');
    overlay.style.display = sidebar.classList.contains('show') ? 'block' : 'none';
    body.classList.toggle('sidebar-open', sidebar.classList.contains('show'));
});

overlay.addEventListener('click', () => {
    sidebar.classList.remove('show');
    overlay.style.display = 'none';
    body.classList.remove('sidebar-open');
});

// Simple search filter
const searchInput = document.getElementById('searchInput');
if(searchInput){
    searchInput.addEventListener('keyup', function() {
        const filter = this.value.toLowerCase();
        const rows = document.querySelectorAll('#queryTable tbody tr');
        rows.forEach(row => {
            const queryText = row.cells[1].textContent.toLowerCase();
            row.style.display = queryText.includes(filter) ? '' : 'none';
        });
    });
}
</script>
{% endblock %}
